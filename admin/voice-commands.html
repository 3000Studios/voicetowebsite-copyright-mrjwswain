<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>God Mode Voice Command Center</title>
    <link rel="stylesheet" href="../styles.css" />
    <link rel="stylesheet" href="/admin/admin.css" />
    <script src="/admin/access-guard.js" type="module" defer></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --god-bg: #040612;
        --god-surface: rgba(10, 12, 27, 0.85);
        --god-surface-2: rgba(21, 24, 45, 0.85);
        --god-grid: rgba(255, 255, 255, 0.08);
        --god-border: rgba(255, 255, 255, 0.12);
        --god-green: #31f6b6;
        --god-blue: #38b6ff;
        --god-purple: #8b5cf6;
        --god-gold: #facc15;
        --god-danger: #fb7185;
        --gradient-money: linear-gradient(120deg, #31f6b6, #38b6ff 45%, #9a7bff 85%);
        --gradient-fire: linear-gradient(120deg, #facc15, #fb7185 60%, #f472b6);
      }

      body {
        background:
          radial-gradient(circle at 20% 20%, rgba(56, 182, 255, 0.2), transparent 45%),
          radial-gradient(circle at 80% 0%, rgba(139, 92, 246, 0.23), transparent 50%),
          radial-gradient(circle at 50% 80%, rgba(49, 246, 182, 0.18), transparent 50%), var(--god-bg);
        color: #f8fafc;
        font-family:
          "Space Grotesk",
          "Inter",
          system-ui,
          -apple-system,
          sans-serif;
        margin: 0;
        min-height: 100vh;
      }

      .voice-command-center {
        width: min(1320px, 100%);
        margin: 100px auto 64px;
        padding: 0 2rem 4rem;
        display: flex;
        flex-direction: column;
        gap: 2.5rem;
      }

      .card {
        background: var(--god-surface);
        border: 1px solid var(--god-border);
        border-radius: 28px;
        padding: clamp(1.5rem, 2vw, 2.5rem);
        box-shadow: 0 25px 80px rgba(3, 5, 15, 0.5);
        position: relative;
        overflow: hidden;
      }

      .card::after {
        content: "";
        position: absolute;
        inset: 0;
        background:
          radial-gradient(circle at 15% 20%, rgba(49, 246, 182, 0.12), transparent 45%),
          radial-gradient(circle at 80% 10%, rgba(56, 182, 255, 0.08), transparent 55%);
        pointer-events: none;
      }

      .card > * {
        position: relative;
        z-index: 1;
      }

      .god-hero {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 2rem;
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.65), rgba(8, 11, 24, 0.95));
      }

      .hero-text h1 {
        font-size: clamp(2.4rem, 4vw, 3.5rem);
        margin: 0 0 1rem;
        line-height: 1.1;
        letter-spacing: -0.02em;
      }

      .hero-text p {
        color: rgba(248, 250, 252, 0.84);
        font-size: 1.05rem;
        margin: 0 0 1.5rem;
      }

      .hero-cta {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
      }

      .hero-cta button {
        flex: 1;
        min-width: 180px;
        border-radius: 18px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 1rem 1.25rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        color: #040612;
        background: var(--gradient-money);
        transition: transform 0.2s ease;
      }

      .hero-cta button.secondary {
        background: rgba(255, 255, 255, 0.08);
        color: #f8fafc;
        border-color: rgba(255, 255, 255, 0.16);
      }

      .hero-cta button:hover {
        transform: translateY(-2px) scale(1.01);
      }

      .hero-mission {
        background: rgba(8, 20, 35, 0.7);
        border-radius: 24px;
        padding: 1.5rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .mission-tags {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 0.7rem;
        margin-top: 1rem;
      }

      .mission-tags span {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        font-size: 0.9rem;
        padding: 0.45rem 0.9rem;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.07);
      }

      .pipeline-board {
        display: flex;
        flex-direction: column;
        gap: 1.6rem;
      }

      .pipeline-steps {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 1rem;
      }

      .pipeline-step {
        border-radius: 18px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        padding: 1rem;
        background: rgba(12, 16, 31, 0.9);
        min-height: 130px;
        position: relative;
        overflow: hidden;
        transition: border-color 0.2s ease;
      }

      .pipeline-step h4 {
        margin: 0;
        font-size: 0.95rem;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        color: rgba(248, 250, 252, 0.74);
      }

      .pipeline-step p {
        margin: 0.5rem 0 0;
        font-size: 0.9rem;
        color: rgba(248, 250, 252, 0.65);
      }

      .pipeline-step.active {
        border-color: rgba(49, 246, 182, 0.7);
        box-shadow: 0 0 20px rgba(49, 246, 182, 0.3);
      }

      .pipeline-step.complete {
        border-color: rgba(56, 182, 255, 0.4);
        opacity: 0.85;
      }

      .pipeline-step.error {
        border-color: var(--god-danger);
        box-shadow: 0 0 18px rgba(251, 113, 133, 0.4);
      }

      .control-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
      }

      .control-card h3 {
        margin-top: 0;
        margin-bottom: 1rem;
        font-size: 1.25rem;
      }

      .status-indicator {
        display: flex;
        align-items: center;
        gap: 0.7rem;
        padding: 0.9rem 1.1rem;
        border-radius: 16px;
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.06);
        margin-bottom: 1.25rem;
      }

      .status-dot {
        width: 14px;
        height: 14px;
        border-radius: 50%;
        background: #fb7185;
        box-shadow: 0 0 14px rgba(251, 113, 133, 0.5);
        transition: background 0.2s ease;
      }

      .status-dot.active {
        background: #31f6b6;
        box-shadow: 0 0 16px rgba(49, 246, 182, 0.6);
      }

      .voice-button {
        width: 100%;
        padding: 1.1rem 1.3rem;
        border-radius: 20px;
        border: none;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        margin-bottom: 0.75rem;
        color: #040612;
        background: var(--gradient-money);
        transition: transform 0.2s ease;
      }

      .voice-button.secondary {
        background: rgba(255, 255, 255, 0.08);
        color: #f8fafc;
        border: 1px solid rgba(255, 255, 255, 0.12);
      }

      .voice-button:disabled {
        opacity: 0.4;
        cursor: not-allowed;
      }

      .voice-button:not(:disabled):hover {
        transform: translateY(-2px);
      }

      .transcript-box,
      textarea,
      .plan-output,
      .profit-log {
        background: rgba(4, 7, 20, 0.85);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 20px;
        padding: 1.25rem;
        font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, monospace;
        color: rgba(248, 250, 252, 0.85);
        min-height: 140px;
        line-height: 1.5;
        white-space: pre-wrap;
      }

      textarea {
        width: 100%;
        min-height: 120px;
        resize: vertical;
        font-size: 0.95rem;
      }

      .quick-money {
        display: flex;
        flex-direction: column;
        gap: 1.2rem;
      }

      .command-pill-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1rem;
      }

      .command-pill {
        border-radius: 24px;
        background: rgba(255, 255, 255, 0.07);
        border: 1px solid rgba(255, 255, 255, 0.09);
        padding: 1rem 1.25rem;
        text-align: left;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        transition:
          border-color 0.2s ease,
          transform 0.15s ease;
        color: #f8fafc;
      }

      .command-pill strong {
        display: block;
        font-size: 0.85rem;
        font-weight: 500;
        color: rgba(248, 250, 252, 0.65);
      }

      .command-pill:hover {
        border-color: rgba(49, 246, 182, 0.4);
        transform: translateY(-3px);
      }

      .profit-center {
        display: grid;
        gap: 1.5rem;
      }

      .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 1rem;
      }

      .profit-metric {
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 20px;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
      }

      .profit-metric span {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: rgba(248, 250, 252, 0.55);
      }

      .profit-metric strong {
        font-size: 1.6rem;
      }

      .profit-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
      }

      .profit-actions button {
        border-radius: 24px;
        padding: 1.2rem 1.4rem;
        font-weight: 600;
        font-size: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(255, 255, 255, 0.04);
        color: #f8fafc;
        cursor: pointer;
        text-align: left;
        transition:
          border-color 0.2s ease,
          transform 0.2s ease;
      }

      .profit-actions button.highlight {
        background: var(--gradient-fire);
        border: none;
        color: #040612;
      }

      .profit-actions button:hover {
        border-color: rgba(56, 182, 255, 0.3);
        transform: translateY(-2px);
      }

      .activity-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
      }

      .history-list {
        list-style: none;
        margin: 0;
        padding: 0;
        display: grid;
        gap: 0.6rem;
        font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, monospace;
        font-size: 0.85rem;
      }

      .history-list li {
        padding: 0.7rem 0.9rem;
        border-radius: 14px;
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.05);
      }

      .commands-catalog {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1.2rem;
      }

      .catalog-card {
        border-radius: 22px;
        padding: 1.2rem;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.07);
      }

      .catalog-card h4 {
        margin: 0 0 0.8rem;
        font-size: 1rem;
      }

      .catalog-card ul {
        list-style: none;
        margin: 0;
        padding: 0;
        display: grid;
        gap: 0.4rem;
      }

      .catalog-card li {
        font-size: 0.9rem;
        color: rgba(248, 250, 252, 0.7);
      }

      .section-head {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        flex-wrap: wrap;
        gap: 1rem;
      }

      .section-head h2 {
        margin: 0;
        font-size: 1.8rem;
      }

      .section-head p {
        margin: 0;
        color: rgba(248, 250, 252, 0.7);
        max-width: 520px;
      }

      .plan-output small {
        display: block;
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.15em;
        color: rgba(248, 250, 252, 0.5);
      }

      @media (max-width: 768px) {
        .voice-command-center {
          padding: 0 1rem 2rem;
        }
        .hero-cta button {
          flex: 1 1 100%;
        }
      }
    </style>
  </head>
  <body>
    <script type="module" src="../nav.js"></script>
    <script>
      // Load the machine-readable capability manifest so the Voice Command Center stays aligned
      // with the canonical Worker command surface (also used by Custom GPT clients).
      (async () => {
        try {
          const res = await fetch("/api/capabilities", { cache: "no-store" });
          const data = await res.json().catch(() => ({}));
          if (data && data.manifest) {
            window.__VTW_CAPABILITIES__ = data.manifest;
          }
        } catch (_) {
          // Non-fatal.
        }
      })();
    </script>

    <div class="voice-command-center">
      <section class="god-hero card">
        <div class="hero-text">
          <p class="eyebrow" style="letter-spacing: 0.2em; text-transform: uppercase; color: rgba(248, 250, 252, 0.6)">
            Voice Control Center
          </p>
          <h1>SAY IT. CHANGE IT. SHIP IT.</h1>
          <p>
            Voice or type a command and the site updates instantly. This is the fastest path to live edits across any
            page on your site.
          </p>
          <div class="hero-cta">
            <button id="startBtn">üé§ Engage Voice Capture</button>
            <button id="stopBtn" class="secondary" disabled>‚èπÔ∏é Stop Listening</button>
          </div>
        </div>
        <div class="hero-mission">
          <h3 style="margin-top: 0">Mission: LIVE SITE CONTROL</h3>
          <p>Speak ‚Üí Preview ‚Üí Deploy ‚Üí Monitor. Repeat.</p>
          <div class="mission-tags">
            <span>üé§ Voice Control</span>
            <span>‚ö° Instant Updates</span>
            <span>üß† AI Planning</span>
            <span>üöÄ Auto Deploy</span>
            <span>üß™ Safe Preview</span>
            <span>üìä Monitor</span>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="section-head">
          <div>
            <h2>Quick Start</h2>
            <p>Three steps to live updates with voice or text.</p>
          </div>
        </div>
        <div class="help-grid">
          <div class="help-card">
            <div class="hint-title">1) Start Voice</div>
            <p class="muted">Press Start, then speak a command.</p>
          </div>
          <div class="help-card">
            <div class="hint-title">2) Say the change</div>
            <p class="muted">‚ÄúChange headline to Future of Web.‚Äù</p>
          </div>
          <div class="help-card">
            <div class="hint-title">3) Ship it</div>
            <p class="muted">Autonomous mode applies + deploys.</p>
          </div>
        </div>
        <div class="media-strip" style="margin-top: 1.2rem">
          <div class="media-card">
            <video src="/media/vtw-animated-logo.mp4" autoplay muted loop playsinline></video>
            <div class="media-card__body">
              <strong>Voice Capture</strong>
              <span>Live mic + transcript.</span>
            </div>
          </div>
          <div class="media-card">
            <video src="/media/vtw-home-wallpaper.mp4" autoplay muted loop playsinline></video>
            <div class="media-card__body">
              <strong>Preview & Diff</strong>
              <span>See changes before deploy.</span>
            </div>
          </div>
          <div class="media-card">
            <video src="/media/vtw-opener.mp4" autoplay muted loop playsinline></video>
            <div class="media-card__body">
              <strong>Live Deploy</strong>
              <span>Ship to production instantly.</span>
            </div>
          </div>
        </div>
      </section>

      <section class="card pipeline-board">
        <div class="section-head">
          <div>
            <h2>Execution Pipeline</h2>
            <p>Every command is processed through a safe plan ‚Üí preview ‚Üí deploy flow.</p>
          </div>
          <div class="status-indicator" style="margin-bottom: 0">
            <div class="status-dot" id="statusDot"></div>
            <span id="statusText">Ready</span>
          </div>
        </div>
        <div class="pipeline-steps" id="pipelineBoard">
          <div class="pipeline-step" data-stage="intent">
            <h4>Intent Capture</h4>
            <p>Voice ‚Üí Text ‚Üí Structured monetization intent.</p>
          </div>
          <div class="pipeline-step" data-stage="strategy">
            <h4>Revenue Strategy</h4>
            <p>Detect niche, traffic, best-fit monetization path.</p>
          </div>
          <div class="pipeline-step" data-stage="policy">
            <h4>Policy & Risk</h4>
            <p>Role gate, risk gate, compliance, guardrails.</p>
          </div>
          <div class="pipeline-step" data-stage="patch">
            <h4>Patch Engine</h4>
            <p>Apply config, offers, assets, pricing.</p>
          </div>
          <div class="pipeline-step" data-stage="preview">
            <h4>Preview Renderer</h4>
            <p>Sandbox render + diff + tracking install.</p>
          </div>
          <div class="pipeline-step" data-stage="simulation">
            <h4>Revenue Sim</h4>
            <p>Projected daily / monthly / yearly lift.</p>
          </div>
          <div class="pipeline-step" data-stage="diff">
            <h4>Diff Engine</h4>
            <p>UI + JSON + revenue delta.</p>
          </div>
          <div class="pipeline-step" data-stage="confirm">
            <h4>Confirm Token</h4>
            <p>Hash-locked approval for prod deploy.</p>
          </div>
          <div class="pipeline-step" data-stage="deploy">
            <h4>Atomic Deploy</h4>
            <p>Cloudflare Worker + Durable Objects + KV.</p>
          </div>
          <div class="pipeline-step" data-stage="monitor">
            <h4>Monitor & Optimize</h4>
            <p>Snapshots, audit log, profit dashboard.</p>
          </div>
        </div>
      </section>

      <section class="control-grid">
        <div class="control-card card">
          <h3>Voice Recognition Engine</h3>
          <button class="voice-button" onclick="executeCommand('make_money fast with full automation')">
            ‚ö° Make Me Money Fast
          </button>
          <button
            class="voice-button secondary"
            onclick="executeCommand('make me money long term with seo compounding')"
          >
            ‚ôæÔ∏è Long-Term Compounding
          </button>
          <div class="transcript-box" id="transcript">Waiting for voice input...</div>
        </div>
        <div class="control-card card">
          <h3>Manual Command Builder</h3>
          <form id="moneyCommandForm" style="display: grid; gap: 0.9rem">
            <label>
              Monetization Method
              <select
                id="methodSelect"
                style="
                  border-radius: 16px;
                  padding: 0.8rem;
                  background: rgba(4, 7, 20, 0.9);
                  color: #f8fafc;
                  border: 1px solid rgba(255, 255, 255, 0.08);
                "
              >
                <option value="ads">ads</option>
                <option value="affiliate">affiliate</option>
                <option value="subscriptions">subscriptions</option>
                <option value="digitalProducts">digitalProducts</option>
                <option value="leadgen">leadgen</option>
                <option value="saas">saas</option>
                <option value="services">services</option>
                <option value="marketplace">marketplace</option>
              </select>
            </label>
            <label>
              Target Monthly Revenue ($)
              <input
                type="number"
                id="targetRevenue"
                value="2000"
                min="100"
                step="100"
                style="
                  border-radius: 16px;
                  padding: 0.8rem;
                  background: rgba(4, 7, 20, 0.9);
                  color: #f8fafc;
                  border: 1px solid rgba(255, 255, 255, 0.08);
                "
              />
            </label>
            <label>
              Risk Tolerance
              <select
                id="riskTolerance"
                style="
                  border-radius: 16px;
                  padding: 0.8rem;
                  background: rgba(4, 7, 20, 0.9);
                  color: #f8fafc;
                  border: 1px solid rgba(255, 255, 255, 0.08);
                "
              >
                <option value="low">low</option>
                <option value="medium" selected>medium</option>
                <option value="high">high</option>
              </select>
            </label>
            <label>
              Traffic Strategy
              <select
                id="trafficStrategy"
                style="
                  border-radius: 16px;
                  padding: 0.8rem;
                  background: rgba(4, 7, 20, 0.9);
                  color: #f8fafc;
                  border: 1px solid rgba(255, 255, 255, 0.08);
                "
              >
                <option value="seo">seo</option>
                <option value="ads">ads</option>
                <option value="social">social</option>
                <option value="mixed" selected>mixed</option>
              </select>
            </label>
            <label>
              Command Notes
              <textarea
                id="manualCommand"
                placeholder="e.g. Make me money with affiliate SEO + sticky CTA bars"
              ></textarea>
            </label>
            <div style="display: flex; gap: 0.8rem; flex-wrap: wrap; align-items: center">
              <button type="submit" class="voice-button" id="manualSubmit">Send Command</button>
              <button type="button" class="voice-button secondary" id="shipButton" onclick="shipIt()" disabled>
                Ship It
              </button>
            </div>
          </form>
        </div>
        <div class="control-card card">
          <h3>Revenue Plan + Response</h3>
          <div class="plan-output" id="response">
            <small>Command Output</small>
            Command responses will appear here...
          </div>
          <button class="voice-button secondary" onclick="clearResponse()">üóëÔ∏è Reset Panels</button>
        </div>
      </section>

      <section class="card quick-money">
        <div class="section-head">
          <div>
            <h2>Master Money Commands</h2>
            <p>One click voice macros that auto-build monetization flows, offers, funnels, and tracking.</p>
          </div>
        </div>
        <div class="command-pill-grid">
          <button class="command-pill" data-command="Make me money with ads">
            Make Money with Ads
            <strong>enable_adsense ‚Ä¢ create_ad_placements ‚Ä¢ optimize_ad_layout</strong>
          </button>
          <button class="command-pill" data-command="Make me money with affiliates">
            Make Money with Affiliates
            <strong>enable_affiliate_engine ‚Ä¢ generate_affiliate_blog_posts</strong>
          </button>
          <button class="command-pill" data-command="Make me money with subscriptions">
            Make Money with Subscriptions
            <strong>create_pricing_page ‚Ä¢ enable_stripe_billing ‚Ä¢ enable_trial_period</strong>
          </button>
          <button class="command-pill" data-command="Make me money selling templates">
            Monetize Digital Products
            <strong>create_digital_storefront ‚Ä¢ enable_instant_delivery</strong>
          </button>
          <button class="command-pill" data-command="Make me money with SaaS tiers">
            SaaS Tiers
            <strong>enable_saas_mode ‚Ä¢ enable_credit_system ‚Ä¢ enable_api_billing</strong>
          </button>
          <button class="command-pill" data-command="Make me money selling leads">
            Lead Generation
            <strong>enable_lead_capture ‚Ä¢ create_booking_page ‚Ä¢ enable_sms_followup</strong>
          </button>
          <button class="command-pill" data-command="Make me money with a marketplace">
            Marketplace Mode
            <strong>enable_marketplace ‚Ä¢ enable_vendor_accounts ‚Ä¢ enable_commission_split</strong>
          </button>
          <button class="command-pill" data-command="Make me money with sponsors">
            Sponsors & Media Kits
            <strong>generate_media_kit ‚Ä¢ enable_sponsor_slots</strong>
          </button>
          <button class="command-pill" data-command="Make me money with SMS promotions">
            SMS Monetization
            <strong>enable_sms_capture ‚Ä¢ enable_sms_promotions</strong>
          </button>
          <button class="command-pill" data-command="Make me money with YouTube automation">
            Video Money Factory
            <strong>auto create shorts ‚Ä¢ sponsor overlays ‚Ä¢ affiliate links</strong>
          </button>
        </div>
      </section>

      <section class="card profit-center">
        <div class="section-head">
          <div>
            <h2>Profit Center Dashboard</h2>
            <p>Live revenue estimates, funnel health, and AI suggestions for the next profit patch.</p>
          </div>
        </div>
        <div class="metrics-grid" id="profitMetrics">
          <div class="profit-metric">
            <span>Daily Revenue Est.</span>
            <strong id="metricDaily">‚Äî</strong>
            <small class="muted">Not connected</small>
          </div>
          <div class="profit-metric">
            <span>Monthly Revenue Est.</span>
            <strong id="metricMonthly">‚Äî</strong>
            <small class="muted">Not connected</small>
          </div>
          <div class="profit-metric">
            <span>Subscription MRR</span>
            <strong id="metricMRR">‚Äî</strong>
            <small class="muted">Not connected</small>
          </div>
          <div class="profit-metric">
            <span>Affiliate Clicks</span>
            <strong id="metricAffiliate">‚Äî</strong>
            <small class="muted">Not connected</small>
          </div>
          <div class="profit-metric">
            <span>Ad RPM</span>
            <strong id="metricRPM">‚Äî</strong>
            <small class="muted">Not connected</small>
          </div>
          <div class="profit-metric">
            <span>Lead Conversion</span>
            <strong id="metricLeads">‚Äî</strong>
            <small class="muted">Not connected</small>
          </div>
        </div>
        <div class="profit-actions">
          <button class="highlight" data-command="Generate monetization offer now">‚ö° Generate New Offer</button>
          <button class="highlight" data-command="Build a full funnel for the highest converting offer">
            üß† Build New Funnel
          </button>
          <button data-command="Run an A/B test on pricing tiers">üß™ Run A/B Test</button>
          <button data-command="Publish 10 SEO posts targeting high intent money keywords">üì∞ Publish SEO Posts</button>
          <button data-command="Ship a profit patch to increase conversions">üö¢ Ship Profit Patch</button>
          <button data-command="Run affiliate upgrade campaign">ü§ù Boost Affiliate Engine</button>
        </div>
        <div class="plan-output" id="planPreview" style="min-height: 180px">
          <small>Revenue Strategy Output</small>
          Strategy output will be displayed here once the engine responds.
        </div>
        <div class="plan-output" id="revenueEstimate" style="min-height: 120px">
          <small>Estimated Revenue (AI)</small>
          Daily ‚Äî ‚Ä¢ Monthly ‚Äî ‚Ä¢ Yearly ‚Äî
        </div>
        <div class="plan-output" id="diffPreview" style="min-height: 120px">
          <small>Diff + Preview</small>
          Awaiting diff output.
        </div>
        <div class="plan-output" id="confirmToken" style="min-height: 90px">
          <small>Confirm Token</small>
          Hash-locked token will appear once build is ready.
        </div>
        <div class="plan-output" id="aiSuggestions" style="min-height: 90px">
          <small>AI Suggestions</small>
          ‚Ä¢ Add a lead magnet ‚Ä¢ Launch a pricing tier ‚Ä¢ Increase CTA density
        </div>
      </section>

      <section class="activity-grid">
        <div class="card" id="botActivitySection">
          <h3 style="margin-top: 0">Bot Activity + Build Queue</h3>
          <div id="botActivityList" style="display: grid; gap: 1rem">
            <div style="color: rgba(248, 250, 252, 0.6)">Connecting to bots...</div>
          </div>
        </div>
        <div class="card">
          <h3 style="margin-top: 0">Command History</h3>
          <ul class="history-list" id="commandHistory"></ul>
          <button class="voice-button secondary" id="clearHistory">Clear History</button>
        </div>
      </section>

      <section class="card">
        <div class="section-head" style="margin-bottom: 1.5rem">
          <div>
            <h2>Monetization Command Catalog</h2>
            <p>The system isn‚Äôt a site editor. It is a profit machine with a website attached.</p>
          </div>
        </div>
        <div class="commands-catalog">
          <div class="catalog-card">
            <h4>Ads</h4>
            <ul>
              <li>enable_adsense</li>
              <li>create_ad_placements</li>
              <li>enable_ad_lazyload</li>
              <li>enable_ad_ab_testing</li>
            </ul>
          </div>
          <div class="catalog-card">
            <h4>Affiliate</h4>
            <ul>
              <li>enable_affiliate_engine</li>
              <li>add_affiliate_offer</li>
              <li>generate_comparison_pages</li>
              <li>enable_click_tracking</li>
            </ul>
          </div>
          <div class="catalog-card">
            <h4>Digital Products</h4>
            <ul>
              <li>create_product_download</li>
              <li>generate_sales_page</li>
              <li>enable_license_key_delivery</li>
              <li>enable_watermarking</li>
            </ul>
          </div>
          <div class="catalog-card">
            <h4>Subscriptions</h4>
            <ul>
              <li>enable_membership</li>
              <li>create_pricing_page</li>
              <li>enable_coupon_codes</li>
              <li>enable_cancel_flow</li>
            </ul>
          </div>
          <div class="catalog-card">
            <h4>Lead Gen</h4>
            <ul>
              <li>enable_lead_capture</li>
              <li>create_lead_magnet</li>
              <li>enable_sms_followup</li>
              <li>enable_pipeline_dashboard</li>
            </ul>
          </div>
          <div class="catalog-card">
            <h4>Services</h4>
            <ul>
              <li>create_service_packages</li>
              <li>enable_invoice_generation</li>
              <li>enable_payment_deposits</li>
              <li>enable_client_portal</li>
            </ul>
          </div>
          <div class="catalog-card">
            <h4>Courses</h4>
            <ul>
              <li>create_course_portal</li>
              <li>enable_drip_release</li>
              <li>enable_course_checkout</li>
              <li>enable_course_upsells</li>
            </ul>
          </div>
          <div class="catalog-card">
            <h4>Marketplace</h4>
            <ul>
              <li>enable_marketplace</li>
              <li>enable_vendor_accounts</li>
              <li>enable_vendor_payouts</li>
              <li>enable_featured_listings</li>
            </ul>
          </div>
          <div class="catalog-card">
            <h4>SMS + Push</h4>
            <ul>
              <li>enable_sms_promotions</li>
              <li>enable_sms_notifications</li>
              <li>enable_push_optin</li>
              <li>retargeting_push</li>
            </ul>
          </div>
          <div class="catalog-card">
            <h4>Licensing / API</h4>
            <ul>
              <li>enable_white_label_mode</li>
              <li>generate_license_contract_template</li>
              <li>enable_api_billing</li>
              <li>issue_paid_api_keys</li>
            </ul>
          </div>
        </div>
      </section>
    </div>

    <script>
      const pipelineStages = [
        "intent",
        "strategy",
        "policy",
        "patch",
        "preview",
        "simulation",
        "diff",
        "confirm",
        "deploy",
        "monitor",
      ];
      const pipelineEls = Array.from(document.querySelectorAll(".pipeline-step"));
      const startBtn = document.getElementById("startBtn");
      const stopBtn = document.getElementById("stopBtn");
      const transcriptBox = document.getElementById("transcript");
      const responseBox = document.getElementById("response");
      const planPreview = document.getElementById("planPreview");
      const revenueEstimate = document.getElementById("revenueEstimate");
      const diffPreview = document.getElementById("diffPreview");
      const confirmTokenBox = document.getElementById("confirmToken");
      const aiSuggestionsBox = document.getElementById("aiSuggestions");
      const historyList = document.getElementById("commandHistory");
      const form = document.getElementById("moneyCommandForm");
      const defaultSuggestions = [
        "Add a lead magnet",
        "Launch a pricing tier",
        "Increase CTA density",
        "Publish 10 SEO posts",
        "Add upsell on checkout",
        "Build comparison funnel",
      ];

      const updateSuggestions = (extra = []) => {
        const merged = [...extra, ...defaultSuggestions];
        aiSuggestionsBox.innerHTML = `<small>AI Suggestions</small>‚Ä¢ ${merged.slice(0, 5).join("<br>‚Ä¢ ")}`;
      };
      updateSuggestions();

      const setPipelineStage = (stage, { error = false } = {}) => {
        const index = pipelineStages.indexOf(stage);
        pipelineEls.forEach((el) => {
          el.classList.remove("active", "complete", "error");
          const stepIndex = pipelineStages.indexOf(el.dataset.stage);
          if (stepIndex < index) {
            el.classList.add("complete");
          } else if (stepIndex === index) {
            el.classList.add(error ? "error" : "active");
          }
        });
        if (error) return;
        if (index === pipelineStages.length - 1) {
          pipelineEls.forEach((el) => {
            if (el.dataset.stage !== stage) {
              el.classList.add("complete");
            }
          });
        }
      };

      let pipelineInterval = null;
      const beginPipeline = () => {
        clearInterval(pipelineInterval);
        let idx = 0;
        setPipelineStage(pipelineStages[idx]);
        pipelineInterval = setInterval(() => {
          idx = Math.min(idx + 1, pipelineStages.length - 2);
          setPipelineStage(pipelineStages[idx]);
        }, 1800);
      };

      const endPipeline = (success = true) => {
        clearInterval(pipelineInterval);
        if (success) {
          setPipelineStage("monitor");
        }
      };

      let recognition = null;
      if ("webkitSpeechRecognition" in window || "SpeechRecognition" in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.continuous = true;
        recognition.interimResults = true;
        recognition.lang = "en-US";

        recognition.onstart = () => {
          document.getElementById("statusText").textContent = "Listening...";
          document.getElementById("statusDot").classList.add("active");
          startBtn.disabled = true;
          stopBtn.disabled = false;
        };

        recognition.onend = () => {
          document.getElementById("statusText").textContent = "Ready";
          document.getElementById("statusDot").classList.remove("active");
          startBtn.disabled = false;
          stopBtn.disabled = true;
        };

        recognition.onresult = (event) => {
          let interimTranscript = "";
          let finalTranscript = "";
          for (let i = event.resultIndex; i < event.results.length; i++) {
            const transcript = event.results[i][0].transcript;
            if (event.results[i].isFinal) {
              finalTranscript += transcript + " ";
            } else {
              interimTranscript += transcript;
            }
          }
          transcriptBox.textContent = finalTranscript + (interimTranscript ? `\n[${interimTranscript.trim()}]` : "");
          if (finalTranscript.trim()) {
            executeCommand(finalTranscript.trim());
          }
        };

        recognition.onerror = (event) => {
          console.error("Speech recognition error:", event.error);
          document.getElementById("statusText").textContent = `Error: ${event.error}`;
        };
      } else {
        startBtn.disabled = true;
        transcriptBox.textContent = "Speech recognition is not supported in this browser. Please use Chrome or Edge.";
      }

      startBtn.addEventListener("click", () => {
        if (recognition) recognition.start();
      });

      stopBtn.addEventListener("click", () => {
        if (recognition) recognition.stop();
      });

      const HISTORY_KEY = "vtw-command-history";
      const renderHistory = () => {
        if (!historyList) return;
        const items = JSON.parse(sessionStorage.getItem(HISTORY_KEY) || "[]");
        historyList.innerHTML = "";
        if (!items.length) {
          historyList.innerHTML = "<li>No recent commands yet.</li>";
          return;
        }
        items.forEach((entry) => {
          const li = document.createElement("li");
          li.textContent = `${entry.text} ‚Äî ${new Date(entry.ts).toLocaleString()}`;
          historyList.appendChild(li);
        });
      };

      const logCommand = (text) => {
        if (!text) return;
        const items = JSON.parse(sessionStorage.getItem(HISTORY_KEY) || "[]");
        items.unshift({ text, ts: new Date().toISOString() });
        sessionStorage.setItem(HISTORY_KEY, JSON.stringify(items.slice(0, 30)));
        renderHistory();
      };

      document.getElementById("clearHistory")?.addEventListener("click", () => {
        sessionStorage.removeItem(HISTORY_KEY);
        renderHistory();
      });

      renderHistory();

      const updatePlanPanels = (data) => {
        const stringify = (value) => {
          if (!value) return "‚Äî";
          if (typeof value === "string") return value;
          try {
            return JSON.stringify(value, null, 2);
          } catch (err) {
            return String(value);
          }
        };
        planPreview.innerHTML = `<small>Revenue Strategy Output</small>${stringify(
          data.plan || data.output?.plan || data.output || data
        )}`;
        const revenue = data.estimatedRevenue || data.revenue || data.output?.estimatedRevenue;
        const fmtMoney = (v) => (typeof v === "number" && Number.isFinite(v) ? `$${v.toFixed(2)}` : "‚Äî");
        if (revenue) {
          revenueEstimate.innerHTML = `<small>Estimated Revenue (AI)</small>Daily ${fmtMoney(
            revenue.daily
          )} ‚Ä¢ Monthly ${fmtMoney(revenue.monthly)} ‚Ä¢ Yearly ${fmtMoney(revenue.yearly)}`;
        } else {
          revenueEstimate.innerHTML = `<small>Estimated Revenue (AI)</small>Daily ‚Äî ‚Ä¢ Monthly ‚Äî ‚Ä¢ Yearly ‚Äî`;
        }
        if (data.diff) {
          diffPreview.innerHTML = `<small>Diff + Preview</small>${stringify(data.diff)}`;
        }
        if (data.preview || data.previewUrl) {
          diffPreview.innerHTML += `\nPreview: ${data.preview || data.previewUrl}`;
        }
        if (data.confirmToken) {
          confirmTokenBox.innerHTML = `<small>Confirm Token</small>${data.confirmToken}`;
        }
        if (Array.isArray(data.suggestions)) {
          updateSuggestions(data.suggestions);
        }
      };

      let lastPreview = null;

      async function executeCommand(command) {
        if (!command) return;
        beginPipeline();
        const shipButton = document.getElementById("shipButton");
        if (shipButton) shipButton.disabled = true;
        responseBox.innerHTML = `<small>Command Output</small>Inferring intent + generating preview...`;
        try {
          const response = await fetch("/api/godmode/infer", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              rawInput: command,
              idempotencyKey: `voice-${Date.now()}`,
            }),
          });

          const data = await response.json();
          if (!response.ok) {
            responseBox.innerHTML = `<small>Command Output</small>‚ùå Error: ${data.error || "Unknown error"}`;
            setPipelineStage("diff", { error: true });
            endPipeline(false);
            return;
          }

          lastPreview = data;
          if (shipButton) shipButton.disabled = false;
          responseBox.innerHTML = `<small>Command Output</small>‚úÖ Preview staged.\n\n${JSON.stringify(
            { commandId: data.commandId, idempotencyKey: data.idempotencyKey, ioo: data.ioo },
            null,
            2
          )}`;

          // The orchestrator preview is nested in data.preview (mode/plan payload).
          updatePlanPanels(data.preview || {});
          if (data.confirmToken) {
            confirmTokenBox.innerHTML = `<small>Confirm Token</small>${data.confirmToken}`;
          }
          endPipeline(true);
          logCommand(command);
        } catch (error) {
          responseBox.innerHTML = `<small>Command Output</small>‚ùå Network Error: ${error.message}`;
          console.error("Command execution error:", error);
          setPipelineStage("strategy", { error: true });
          endPipeline(false);
        }
      }

      async function shipIt() {
        if (!lastPreview?.confirmToken || !lastPreview?.idempotencyKey) {
          alert("No preview staged yet. Run a command first.");
          return;
        }
        responseBox.innerHTML = `<small>Command Output</small>Applying + deploying...`;
        try {
          const applyRes = await fetch("/api/execute", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              action: "apply",
              idempotencyKey: lastPreview.idempotencyKey,
              command: lastPreview.enrichedCommand || lastPreview.ioo?.rawInput || "",
              confirmToken: lastPreview.confirmToken,
              target: "site",
              actor: "admin-voice",
            }),
          });
          const applyJson = await applyRes.json().catch(() => ({}));
          if (!applyRes.ok) throw new Error(applyJson?.error?.message || applyJson?.error || "Apply failed");

          const deployRes = await fetch("/api/execute", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              action: "deploy",
              idempotencyKey: lastPreview.idempotencyKey,
              command: "Deploy latest approved changes",
              confirmToken: lastPreview.confirmToken,
              target: "site",
              actor: "admin-voice",
            }),
          });
          const deployJson = await deployRes.json().catch(() => ({}));
          if (!deployRes.ok) throw new Error(deployJson?.error?.message || deployJson?.error || "Deploy failed");

          responseBox.innerHTML = `<small>Command Output</small>‚úÖ Shipped.\n\n${JSON.stringify(
            { apply: applyJson.eventType, deploy: deployJson.eventType, deployResult: deployJson.result || {} },
            null,
            2
          )}`;
        } catch (err) {
          responseBox.innerHTML = `<small>Command Output</small>‚ùå Ship failed: ${err.message}`;
        }
      }

      function clearResponse() {
        const shipButton = document.getElementById("shipButton");
        if (shipButton) shipButton.disabled = true;
        responseBox.innerHTML = "<small>Command Output</small>Command responses will appear here...";
        planPreview.innerHTML =
          "<small>Revenue Strategy Output</small>Strategy output will be displayed here once the engine responds.";
        revenueEstimate.innerHTML = "<small>Estimated Revenue (AI)</small>Daily ‚Äî ‚Ä¢ Monthly ‚Äî ‚Ä¢ Yearly ‚Äî";
        diffPreview.innerHTML = "<small>Diff + Preview</small>Awaiting diff output.";
        confirmTokenBox.innerHTML = "<small>Confirm Token</small>Hash-locked token will appear once build is ready.";
        transcriptBox.textContent = "Waiting for voice input...";
      }

      form?.addEventListener("submit", (event) => {
        event.preventDefault();
        const method = document.getElementById("methodSelect").value;
        const revenue = Number(document.getElementById("targetRevenue").value) || 2000;
        const risk = document.getElementById("riskTolerance").value;
        const traffic = document.getElementById("trafficStrategy").value;
        const notes = document.getElementById("manualCommand").value?.trim();
        const payload = {
          intent: "make_money",
          siteId: "voicetowebsite",
          environment: "preview",
          payload: {
            method,
            targetRevenue: { monthly: revenue },
            riskTolerance: risk,
            style: "midnight-steel",
            automationLevel: "full",
            contentAggression: "aggressive",
            trafficStrategy: traffic,
            notes,
          },
        };
        executeCommand(JSON.stringify(payload));
      });

      document.querySelectorAll("[data-command]").forEach((btn) => {
        btn.addEventListener("click", () => executeCommand(btn.dataset.command));
      });

      // Polling Bots Status
      async function pollBots() {
        const list = document.getElementById("botActivityList");
        if (!list) return;
        try {
          const res = await fetch("/api/bots/status");
          if (!res.ok) throw new Error("Failed to fetch status");
          const data = await res.json();

          const activities = [];
          if (data.commands) {
            data.commands.forEach((c) =>
              activities.push({
                type: "COMMAND",
                ts: c.ts,
                summary: c.command,
                status: c.deployment_status || "processed",
              })
            );
          }
          if (data.builds) {
            data.builds.forEach((b) =>
              activities.push({
                type: "BUILD",
                ts: b.ts,
                summary: "Voice-to-Layout Build",
                status: b.status,
              })
            );
          }

          activities.sort((a, b) => new Date(b.ts) - new Date(a.ts));

          if (!activities.length) {
            list.innerHTML = '<div style="color:rgba(248,250,252,0.65);">No active bots.</div>';
            return;
          }

          list.innerHTML = activities
            .map(
              (act) => `
                <div style="background:rgba(6,10,24,0.9); padding:1rem; border-radius:18px; border-left: 4px solid ${
                  act.status === "failed" ? "#fb7185" : "#31f6b6"
                };">
                    <div style="display:flex;justify-content:space-between;margin-bottom:0.5rem;">
                        <span style="font-weight:bold;color:#fff;">${act.type}</span>
                        <span style="color:rgba(248,250,252,0.6);font-size:0.8rem;">${new Date(act.ts).toLocaleTimeString()}</span>
                    </div>
                    <div style="color:#e2e8f0;">${act.summary}</div>
                    <div style="margin-top:0.5rem;font-size:0.8rem;color:${
                      act.status === "failed" ? "#fb7185" : "#31f6b6"
                    };text-transform:uppercase;">${act.status}</div>
                </div>
             `
            )
            .join("");
        } catch (err) {
          // swallow to avoid noisy UI
        }
      }

      pollBots();
      setInterval(pollBots, 6000);
    </script>
  </body>
</html>
