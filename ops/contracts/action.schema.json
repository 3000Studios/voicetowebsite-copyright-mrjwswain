{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://voicetowebsite.com/schemas/action.schema.json",
  "title": "ExecuteAction",
  "description": "Canonical action payload for /api/execute.",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "action": {
      "type": "string",
      "enum": ["plan", "preview", "apply", "deploy", "status", "rollback"],
      "description": "Operation to run through the orchestrator."
    },
    "idempotencyKey": {
      "type": "string",
      "minLength": 3,
      "description": "Unique key per action request to prevent accidental duplicate execution."
    },
    "command": {
      "type": "string",
      "description": "Natural-language command. Required for plan/preview/apply."
    },
    "target": {
      "type": "string",
      "enum": ["site", "sandbox"],
      "default": "site",
      "description": "Execution target."
    },
    "safetyLevel": {
      "type": "string",
      "enum": ["low", "medium", "high"],
      "default": "medium",
      "description": "Safety classification for caller context."
    },
    "confirmToken": {
      "type": "string",
      "description": "Single-use token returned by preview and required for apply/deploy/rollback."
    },
    "actor": {
      "description": "Calling actor identity.",
      "oneOf": [
        {
          "type": "string"
        },
        {
          "type": "object",
          "additionalProperties": true
        }
      ]
    },
    "parameters": {
      "type": "object",
      "additionalProperties": true,
      "description": "Optional extra parameters for forward compatibility."
    }
  },
  "required": ["action", "idempotencyKey"],
  "allOf": [
    {
      "if": {
        "properties": {
          "action": {
            "enum": ["plan", "preview", "apply"]
          }
        },
        "required": ["action"]
      },
      "then": {
        "required": ["command"]
      }
    },
    {
      "if": {
        "properties": {
          "action": {
            "enum": ["apply", "deploy", "rollback"]
          }
        },
        "required": ["action"]
      },
      "then": {
        "required": ["confirmToken"]
      }
    }
  ]
}
