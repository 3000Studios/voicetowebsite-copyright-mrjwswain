<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>The 3000 Portal</title>
    <meta name="description" content="Private 3000 portal for family media." />
    <meta name="robots" content="noindex, nofollow" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body class="page-3000">
    <video class="bg-video-3000" autoplay muted loop playsinline>
      <source
        src="https://res.cloudinary.com/dj92eb97f/video/upload/v1766972500/3000_studios_back_dop_nldai9.mp4"
        type="video/mp4"
      />
    </video>
    <div class="scrim-3000"></div>

    <div class="deck-3000">
      <div class="marquee-3000" aria-live="polite">
        <span>
          Welcome Jadon, Jerica, Paige (mom) &amp; Dad â€¢ Welcome Jadon, Jerica, Paige
          (mom) &amp; Dad â€¢
        </span>
      </div>

      <div class="showcase-3000">
        <h3>Latest Upload</h3>
        <div class="showcase-frame" id="showcase-frame">
          <div
            class="thumb"
            style="height: 100%; display: grid; place-items: center; color: #fff"
          >
            No media yet.
          </div>
        </div>
      </div>

      <div class="cards-3000" id="family-cards"></div>
    </div>

    <div class="audio-3000">
      <button id="audio-toggle-3000" class="ghost small">ðŸ”Š</button>
      <input
        id="audio-volume-3000"
        type="range"
        min="0"
        max="1"
        step="0.05"
        value="0.35"
      />
    </div>

    <script type="module" src="nav.js"></script>
    <script>
      const family = [
        { name: "Jerica", key: "jerica" },
        { name: "Jadon", key: "jadon" },
        { name: "Mom", key: "mom" },
        { name: "Dad", key: "dad" },
      ];

      const storageKey = (k) => `media-${k}`;
      const loadMedia = (key) =>
        JSON.parse(localStorage.getItem(storageKey(key)) || "[]");
      const saveMedia = (key, list) =>
        localStorage.setItem(
          storageKey(key),
          JSON.stringify(list.slice(-20)),
        );

      const familyCards = document.getElementById("family-cards");
      const showcaseFrame = document.getElementById("showcase-frame");

      const clickSound = () => {
        try {
          const ctx = new (window.AudioContext || window.webkitAudioContext)();
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          osc.type = "sine";
          osc.frequency.value = 660;
          gain.gain.value = 0.08;
          osc.connect(gain);
          gain.connect(ctx.destination);
          osc.start();
          osc.stop(ctx.currentTime + 0.08);
        } catch (_) {}
      };

      const renderShowcase = () => {
        let latest = null;
        family.forEach((p) => {
          const items = loadMedia(p.key);
          items.forEach((m) => {
            if (!latest || m.ts > latest.ts) latest = { ...m, who: p.name };
          });
        });

        showcaseFrame.innerHTML = "";
        if (!latest) {
          showcaseFrame.innerHTML =
            '<div class="thumb" style="height:100%;display:grid;place-items:center;color:#fff;">No media yet.</div>';
          return;
        }

        if (latest.type && latest.type.startsWith("video")) {
          const v = document.createElement("video");
          v.src = latest.data;
          v.controls = true;
          v.autoplay = true;
          v.loop = true;
          showcaseFrame.appendChild(v);
        } else {
          const img = document.createElement("img");
          img.src = latest.data;
          img.alt = latest.who;
          showcaseFrame.appendChild(img);
        }
      };

      const renderCards = () => {
        familyCards.innerHTML = "";
        family.forEach((p) => {
          const card = document.createElement("div");
          card.className = "card-3000";
          card.dataset.person = p.key;

          const preview = document.createElement("div");
          preview.className = "thumb";
          const items = loadMedia(p.key);

          if (items.length) {
            const latest = items[items.length - 1];
            if (latest.type && latest.type.startsWith("video")) {
              const v = document.createElement("video");
              v.src = latest.data;
              v.muted = true;
              v.loop = true;
              v.autoplay = true;
              preview.appendChild(v);
            } else {
              const img = document.createElement("img");
              img.src = latest.data;
              img.alt = p.name;
              img.style.width = "100%";
              img.style.height = "100%";
              img.style.objectFit = "cover";
              preview.appendChild(img);
            }
          } else {
            preview.textContent = "Upload for " + p.name;
          }

          const label = document.createElement("div");
          label.innerHTML = `<strong>${p.name}</strong>`;

          const input = document.createElement("input");
          input.type = "file";
          input.accept = "image/*,video/*";
          input.addEventListener("click", (e) => e.stopPropagation());
          input.addEventListener("change", (e) => {
            const file = e.target.files?.[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = () => {
              const list = loadMedia(p.key);
              list.push({ data: reader.result, type: file.type || "", ts: Date.now() });
              saveMedia(p.key, list);
              renderCards();
              renderShowcase();
              clickSound();
            };
            reader.readAsDataURL(file);
          });

          card.appendChild(preview);
          card.appendChild(label);
          card.appendChild(input);

          card.addEventListener("click", () => {
            window.location.href = `/the3000-gallery?user=${encodeURIComponent(p.key)}`;
          });

          familyCards.appendChild(card);
        });
      };

      renderCards();
      renderShowcase();

      (() => {
        const audio = new Audio(
          "https://res.cloudinary.com/dj92eb97f/video/upload/v1767038694/lounge-house-music-348882_fbmwtq.mp3",
        );
        audio.loop = true;
        const toggle = document.getElementById("audio-toggle-3000");
        const slider = document.getElementById("audio-volume-3000");

        const tryPlay = () => audio.play().catch(() => {});

        slider.addEventListener("input", () => {
          audio.volume = Number(slider.value || 0.35);
        });

        toggle.addEventListener("click", () => {
          if (audio.paused) {
            tryPlay();
            toggle.textContent = "ðŸ”Š";
          } else {
            audio.pause();
            toggle.textContent = "ðŸ”ˆ";
          }
        });

        audio.volume = Number(slider.value || 0.35);
        tryPlay();
      })();

      document.addEventListener("click", (e) => {
        if (e.target.closest("button") || e.target.closest(".card-3000")) {
          clickSound();
        }
      });
    </script>
  </body>
</html>
