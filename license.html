<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>License Portal | VoiceToWebsite</title>
    <meta name="description" content="Verify your VoiceToWebsite license key to unlock the downloadable demo kit." />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="page" id="main">
      <section class="section hero">
        <p class="eyebrow">Licensing</p>
        <h1 class="vt-h1">License Portal</h1>
        <p class="subhead">
          Enter your license key to unlock the downloadable VoiceToWebsite demo kit. Weekly and monthly keys are
          supported.
        </p>
        <div class="trust-strip">
          <span>Weekly license keys</span>
          <span>Monthly license keys</span>
          <span>Admin-issued tokens</span>
        </div>
      </section>

      <section class="section">
        <h2>Verify license</h2>
        <p class="subhead">Paste your key to unlock the download.</p>
        <div class="feature-card">
          <form id="license-form" class="prompt-shell">
            <label class="prompt-label" for="license-key">License key</label>
            <input id="license-key" type="text" placeholder="vtw1.xxxxx.yyyyy" required />
            <div class="prompt-actions">
              <button class="btn btn-primary" type="submit">Verify</button>
              <a class="btn btn-ghost" href="/store">Purchase a license</a>
            </div>
          </form>
          <div id="license-status" class="muted" style="margin-top: 0.8rem"></div>
          <div class="prompt-actions" style="margin-top: 1rem">
            <a
              id="download-link"
              class="btn btn-ghost"
              href="#"
              download="voicetowebsite-demo-kit.html"
              aria-disabled="true"
            >
              Download demo kit
            </a>
            <a class="btn btn-ghost" href="/support">Need help?</a>
          </div>
        </div>
      </section>

      <section class="section">
        <h2>How it works</h2>
        <div class="vt-grid">
          <article class="feature-card">
            <h3>1. Buy a plan</h3>
            <p class="muted">Purchase a weekly or monthly plan from the Store.</p>
          </article>
          <article class="feature-card">
            <h3>2. Receive a key</h3>
            <p class="muted">Your license key is issued by an admin after payment confirmation.</p>
          </article>
          <article class="feature-card">
            <h3>3. Unlock downloads</h3>
            <p class="muted">Verify the key here to unlock the demo kit.</p>
          </article>
        </div>
      </section>
    </main>

    <script>
      const form = document.getElementById("license-form");
      const statusEl = document.getElementById("license-status");
      const downloadLink = document.getElementById("download-link");

      const setStatus = (text, ok) => {
        statusEl.textContent = text;
        statusEl.style.color = ok ? "rgba(16,185,129,0.9)" : "rgba(248,113,113,0.95)";
      };

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const input = document.getElementById("license-key");
        const license = String(input.value || "").trim();
        if (!license) return;
        setStatus("Verifying license...", true);
        try {
          const res = await fetch("/api/license/verify", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ license }),
          });
          const data = await res.json().catch(() => ({}));
          if (!res.ok || !data?.ok) throw new Error(data?.error || "Verification failed.");
          const exp = data?.data?.exp ? new Date(data.data.exp * 1000).toLocaleString() : "Unknown";
          setStatus(`License verified. Expires: ${exp}`, true);
          downloadLink.href = "/downloads/vtw-demo-kit.html";
          downloadLink.setAttribute("aria-disabled", "false");
          downloadLink.classList.remove("btn-ghost");
          downloadLink.classList.add("btn-primary");
        } catch (err) {
          setStatus(err.message || "Verification failed.", false);
        }
      });
    </script>
    <script type="module" src="/nav.js"></script>
  </body>
</html>
